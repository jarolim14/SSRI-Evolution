<!DOCTYPE html>
<meta charset="utf-8">
<title>Pharmacology Visualisation</title>
<style>
/* ... (Your existing CSS styles remain unchanged) ... */
</style>
<select id="datasetSelect">
  <option value="overview" selected>Overview</option>
  <option value="pharmacology">Pharmacology</option>
  <option value="indications">Indications</option>
  <option value="safety">Safety</option>
  <option value="other">Other</option>
</select>
<form>
  <label><input type="radio" name="mode" value="cluster" checked> Dendrogram</label>
  <label><input type="radio" name="mode" value="tree"> Tree</label>
  <button id="saveButton">Save as SVG</button>
</form>
<svg width="960" height="1400"></svg>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>


  "overview": {
    "name": "Topic Overview",
    "children": [
      {
        "name": "Pharmacology",
        "children": [
          {
            "name": "Pharmacodynamics",
            "children": [
              {
                "name": "Mechanism of action"
              },
              {
                "name": "Animal Models of Disorders"
              },
              {
                "name": "Other"
              }
            ]
          },
          {
            "name": "Pharmacokinetics"
          },
          {
            "name": "Pharmacogenetics"
          },
          {
            "name": "Analytical Methods"
          },
          {
            "name": "Other"
          }
        ]
      },
      {
        "name": "Indications",
        "children": [
          {
            "name": "Disorders",
            "children": [
              {
                "name": "Depressive Disorders"
              },
              {
                "name": "Anxiety"
              },
              {
                "name": "Weight and Eating Disorders"
              },
              {
                "name": "Substance Abuse/Addictions"
              },
              {
                "name": "Other"
              }
            ]
          }
        ]
      },
      {
        "name": "Safety",
        "children": [
          {
            "name": "Special Populations",
            "children": [
              {
                "name": "Pediatrics"
              },
              {
                "name": "Geriatrics"
              },
              {
                "name": "Other"
              }
            ]
          },
          {
            "name": "Perinatal Exposure"
          },
          {
            "name": "Suicide"
          },
          {
            "name": "Sexual Dysfunction"
          },
          {
            "name": "Toxicity"
          },
          {
            "name": "Other"
          }
        ]
      },
      {
        "name": "Other",
        "children": [
          {
            "name": "Ecotoxicology"
          },
          {
            "name": "Alternative Treatments"
          },
          {
            "name": "Other"
          }
        ]
      }
    ]
  },
  "pharmacology": {
    "name": "Pharmacology",
    "children": [
      {
        "name": "Pharmacodynamics",
        "children": [
          {
            "name": "Mechanism of action",
            "children": [
              {
                "name": "Serotonin Receptor Modulation in SSRI Treatment"
              },
              {
                "name": "Impact of SSRIs on Neurogenesis"
              },
              {
                "name": "SSRIs Effect on Neural Processing of Emotional Cues"
              },
              {
                "name": "Paroxetine Binding"
              },
              {
                "name": "SSRIs Effect on Fear"
              },
              {
                "name": "Structural Basis of Serotonin Transporter Inhibition by SSRIs"
              },
              {
                "name": "SSRIs and Inflammation"
              },
              {
                "name": "SSRIs Effects on Neuroendocrine System"
              },
              {
                "name": "SSRIs for Substance Abuse (Cocaine)"
              },
              {
                "name": "SSRIs Effects on Ion Channels"
              },
              {
                "name": "SSRIs Effects on Antimicrobials and Gut Microbiome"
              },
              {
                "name": "Astrocyte Receptors as a Target for SSRIs"
              },
              {
                "name": "Repeated SSRIs Exposures Effects on Dopamine Receptors"
              },
              {
                "name": "SSRIs in Model Organisms ( C. Elegans and Drosophilia)"
              },
              {
                "name": "Predicting SSRI Response in Depression via miRNA and BDNF"
              },
              {
                "name": "SSRIs Effect on Reinforcement Learning in Rodents"
              },
              {
                "name": "Neurochemical and Electrophysiological Correlates of SSRIs"
              },
              {
                "name": "SSRIs Effect on Brain-derived Neurotrophic Factor (BDNF) Levels in Depressive Patients"
              },
              {
                "name": "Paroxetines Therapeutic Potential as G Protein-coupled Receptor Kinase 2 (GRK2) Inhibitor for Cardiovascular Diseases"
              },
              {
                "name": "Loudness Dependence of Auditory Evoked Potentials (LDAEP) as Biomarker for Depression"
              },
              {
                "name": "Tryptophan Depletion in Depression"
              }
            ]
          },
          {
            "name": "Animal Models of Disorders",
            "children": [
              {
                "name": "The Chronic Unpredictable Mild Stress Model of Depression"
              },
              {
                "name": "SSRIs in Forced Swimming Test"
              },
              {
                "name": "Olfactory Bulbectomized (OB) Rat Model of Depression"
              }
            ]
          },
          {
            "name": "Other",
            "children": [
              {
                "name": "SSRIs Effect on Pulmonary Hypertension"
              },
              {
                "name": "SRRIs and Ocular Safety"
              }
            ]
          }
        ]
      },
      {
        "name": "Pharmacokinetics",
        "children": [
          {
            "name": "SSRIs and the Cytochrome P450 System"
          },
          {
            "name": "(Sertraline) Drug Delivery"
          }
        ]
      },
      {
        "name": "Pharmacogenetics",
        "children": [
          {
            "name": "Serotonin Transporter Gene and Antidepressant Response"
          },
          {
            "name": "Genotype Mediated Response to SSRIs"
          }
        ]
      },
      {
        "name": "Analytical Methods",
        "children": [
          {
            "name": "Quantification of SSRIs in Biological Samples"
          },
          {
            "name": "Novel Compounds Synthesis and Antidepressant Potential"
          }
        ]
      },
      {
        "name": "Other",
        "children": [
          {
            "name": "Risks of Prenatal Exposure"
          },
          {
            "name": "SSRI Synthesis"
          },
          {
            "name": "Methylenedioxymethamphetamine (MDMA) Induced Neurotoxicity"
          },
          {
            "name": "SSRIs Effect on Male Fertility"
          }
        ]
      }
    ]
  },
  "indications": {
    "name": "Indications",
    "children": [
      {
        "name": "Disorders",
        "children": [
          {
            "name": "Depressive Disorders",
            "children": [
              {
                "name": "The Chronic Unpredictable Mild Stress Model of Depression"
              },
              {
                "name": "Fluvoxamine for Depression"
              },
              {
                "name": "Pediatric Depression"
              },
              {
                "name": "SSRIs in Forced Swimming Test"
              },
              {
                "name": "Sequenced Depression Treatment"
              },
              {
                "name": "Serotonin Transporter Gene and Antidepressant Response"
              },
              {
                "name": "Post-Stroke SSRI Use"
              },
              {
                "name": "SSRIs for Bipolar Depression"
              },
              {
                "name": "Escitalopram for Depression"
              },
              {
                "name": "Pharmacoeconomics of SSRIs for Depression"
              },
              {
                "name": " Depression in Patients with Cardiovascular Disease"
              },
              {
                "name": "Pharmacological Treatment Strategies of Depression"
              },
              {
                "name": "SSRIs for Depression in Diabetes Patients"
              },
              {
                "name": "SSRIs for Depression with Cognitive Impairment"
              },
              {
                "name": "SSRIs for Depression in in Epileptic Patients"
              },
              {
                "name": "SSRIs for Depression in Parkinsons Patients"
              },
              {
                "name": "Geriatric Depression"
              },
              {
                "name": "Agomelatin for Depression"
              },
              {
                "name": "SSRIs and Augmentation for Treatment Resistant Depression"
              },
              {
                "name": "Depression Treatment in Hepatitis Patients"
              },
              {
                "name": "SSRIs for Depression after Traumatic Brain Injury"
              },
              {
                "name": "Sex differences in SSRI Response"
              },
              {
                "name": "SRRIs and Ocular Safety"
              },
              {
                "name": "Transcranial Direct Current Stimulation (tDCS) for Depression"
              },
              {
                "name": "SSRIs for Depression in Cancer"
              },
              {
                "name": "SSRIs for Dysthymia"
              },
              {
                "name": "SSRIs for Postpartum Depression"
              },
              {
                "name": "St. John's Wort for Depression"
              },
              {
                "name": "SSRIs for Depression in Kidney Disease Patients"
              },
              {
                "name": "SSRIs for Depression in Kidney Disease Patients"
              },
              {
                "name": "Predicting SSRI Response in Depression via miRNA and BDNF"
              },
              {
                "name": "Vilazodone for Depression"
              },
              {
                "name": "SSRIs for the Mangement of Multiple Sclerosis"
              },
              {
                "name": "Folate for Depression"
              },
              {
                "name": "SSRIs for Depression in Chronic Obstructive Pulmonary Disease (COPD) Patients"
              },
              {
                "name": "SSRIs Effect on Brain-derived Neurotrophic Factor (BDNF) Levels in Depressive Patients"
              },
              {
                "name": "SSRIs for Depression in HIV-positive Patients"
              },
              {
                "name": "Loudness Dependence of Auditory Evoked Potentials (LDAEP) as Biomarker for Depression"
              },
              {
                "name": "Olfactory Bulbectomized (OB) Rat Model of Depression"
              },
              {
                "name": "Tryptophan Depletion in Depression"
              }
            ]
          },
          {
            "name": "Anxiety",
            "children": [
              {
                "name": "SSRIs Effect on Fear"
              },
              {
                "name": "SSRIs for Panic Disorder"
              },
              {
                "name": "SSRIs for Generalized Anxiety Disorder (GAD)"
              },
              {
                "name": "SSRIs for Social Anxiety Disorder"
              },
              {
                "name": "SSRIs for Pediatric Anxiety"
              }
            ]
          },
          {
            "name": "Weight and Eating Disorders",
            "children": [
              {
                "name": "SSRIs for Weight Management"
              },
              {
                "name": "SSRIs for Eating Disorders"
              }
            ]
          },
          {
            "name": "Substance Abuse/Addictions",
            "children": [
              {
                "name": "SSRIs for Alcohol Dependence"
              },
              {
                "name": "SSRIs for Substance Abuse (Cocaine)"
              },
              {
                "name": "SSRIs for Behavioral Addictions"
              },
              {
                "name": "SSRIs for Smoking Cessation"
              }
            ]
          },
          {
            "name": "Other",
            "children": [
              {
                "name": "SSRIs for Obsessive-Compulsive Disorder (OCD)"
              },
              {
                "name": "SSRIs for PTSD"
              },
              {
                "name": "SSRIs in Dementias"
              },
              {
                "name": "SSRIs for Pain"
              },
              {
                "name": "SSRIs for (Psycho)dermatological Diseases"
              },
              {
                "name": "SSRIs Effect on Sleep"
              },
              {
                "name": "Fluvoxamine for Covid 19"
              },
              {
                "name": "Premature Ejaculation"
              },
              {
                "name": "SSRIs for Premenstrual Dysphoric Disorder (PMDD)"
              },
              {
                "name": "SSRIs for Irritable Bowel Syndrome"
              },
              {
                "name": "Menopausal Vasomotor Symptoms (Hot flashes)"
              },
              {
                "name": "SSRIs for Borderline Personality Disorder"
              },
              {
                "name": "SSRIs for Autism Spectrum Disorders"
              },
              {
                "name": "SSRIs (Fluvoxamine) for Schizophrenia"
              },
              {
                "name": "SSRIs Effect on Pulmonary Hypertension"
              },
              {
                "name": "SSRIs for Body Dysmorphic Disorder (BDD)"
              },
              {
                "name": "SSRIs for Fibromyalgia"
              },
              {
                "name": "Risk for Orofacial Pain Disorders"
              },
              {
                "name": "SSRIs for Enuresis"
              },
              {
                "name": "SSRIs for Migraine"
              },
              {
                "name": "SSRIs for Trichotillomania"
              },
              {
                "name": "SSRIs for Congenital Myasthenic Syndrome (SCCMS)"
              },
              {
                "name": "SSRIs in the Treatment of Huntington Disease"
              },
              {
                "name": "SSRIs for Tinnitus "
              },
              {
                "name": "SSRIs for Syncope"
              }
            ]
          }
        ]
      }
    ]
  },
  "safety": {
    "name": "Safety",
    "children": [
      {
        "name": "Special Populations",
        "children": [
          {
            "name": "Pediatrics",
            "children": [
              {
                "name": "Pediatric Depression"
              },
              {
                "name": "SSRIs for Pediatric Anxiety"
              }
            ]
          },
          {
            "name": "Geriatrics",
            "children": [
              {
                "name": "SSRIs in Dementias"
              },
              {
                "name": "Fracture Risk"
              },
              {
                "name": "SSRIs for Depression with Cognitive Impairment"
              },
              {
                "name": "SSRIs for Depression in Parkinsons Patients"
              },
              {
                "name": "Harmful Drug Interactions"
              },
              {
                "name": "Hyponatremia Risk"
              },
              {
                "name": "Geriatric Depression"
              }
            ]
          },
          {
            "name": "Other",
            "children": [
              {
                "name": "Post-Stroke SSRI Use"
              },
              {
                "name": " Depression in Patients with Cardiovascular Disease"
              },
              {
                "name": "SSRIs for Depression in Diabetes Patients"
              },
              {
                "name": "SSRIs for Depression in in Epileptic Patients"
              },
              {
                "name": "Depression Treatment in Hepatitis Patients"
              },
              {
                "name": "SSRIs for Depression after Traumatic Brain Injury"
              },
              {
                "name": "SSRIs for Depression in Cancer"
              },
              {
                "name": "SSRIs for Depression in Kidney Disease Patients"
              },
              {
                "name": "SSRIs for the Mangement of Multiple Sclerosis"
              },
              {
                "name": "SSRIs for Depression in Chronic Obstructive Pulmonary Disease (COPD) Patients"
              },
              {
                "name": "SSRIs for Depression in HIV-positive Patients"
              }
            ]
          }
        ]
      },
      {
        "name": "Perinatal Exposure",
        "children": [
          {
            "name": "Risks of Prenatal Exposure"
          },
          {
            "name": "Risk of Perinatal Exposure (Rodents)"
          },
          {
            "name": "SSRIs for Postpartum Depression"
          }
        ]
      },
      {
        "name": "Suicide",
        "children": [
          {
            "name": "The Chronic Unpredictable Mild Stress Model of Depression"
          },
          {
            "name": "Suicice Risk"
          }
        ]
      },
      {
        "name": "Sexual Dysfunction",
        "children": [
          {
            "name": "Sexual Dysfunction"
          },
          {
            "name": "SSRIs Effect on Male Fertility"
          }
        ]
      },
      {
        "name": "Toxicity",
        "children": [
          {
            "name": "Serotonin Syndrome"
          },
          {
            "name": "Methylenedioxymethamphetamine (MDMA) Induced Neurotoxicity"
          },
          {
            "name": "Forensic Drug Concentration"
          },
          {
            "name": "Hepatotoxic Risk"
          }
        ]
      },
      {
        "name": "Other",
        "children": [
          {
            "name": "Bleeding Risk"
          },
          {
            "name": "QTC Prolongation"
          },
          {
            "name": "Oncopreventive and Oncolytic Properties of SSRIs"
          },
          {
            "name": "Extrapyramidal Reactions Risk"
          },
          {
            "name": "SSRIs for Social Anxiety Disorder"
          },
          {
            "name": "SSRI Safety Reviews"
          },
          {
            "name": "Withdrawal Symptoms"
          },
          {
            "name": "Repeated SSRIs Exposures Effects on Dopamine Receptors"
          },
          {
            "name": "Hyperprolactinemia-related Symptoms"
          },
          {
            "name": "SRRIs and Ocular Safety"
          },
          {
            "name": "Risk for Orofacial Pain Disorders"
          },
          {
            "name": "Risk of Hallucinations"
          }
        ]
      }
    ]
  },
  "other": {
    "name": "Other",
    "children": [
      {
        "name": "Ecotoxicology",
        "children": [
          {
            "name": "Aquatic Ecotoxicology"
          },
          {
            "name": "Environmental Degradation of Antidepressants"
          }
        ]
      },
      {
        "name": "Alternative Treatments",
        "children": [
          {
            "name": "Antidepressant-like Effects of Herbal Extracts in Animal Models"
          },
          {
            "name": "St. John's Wort for Depression"
          }
        ]
      },
      {
        "name": "Other",
        "children": [
          {
            "name": "SSRI Utilization Patterns"
          },
          {
            "name": "Pharmacoeconomics of SSRIs for Depression"
          },
          {
            "name": "Menopausal Vasomotor Symptoms (Hot flashes)"
          },
          {
            "name": "Canine Behavioral Disorders"
          },
          {
            "name": "Generic SSRIs"
          },
          {
            "name": "Critical Psychiatry"
          }
        ]
      }
    ]
  }
};
const datasets = ...
const margin = { top: 20, right: 220, bottom: 20, left: 120 };
const width = 960 - margin.left - margin.right;
const height = 1400 - margin.top - margin.bottom;

const svg = d3.select("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
  .append("g")
  .attr("transform", `translate(${margin.left},${margin.top})`);

let tree = d3.tree().size([height - 400, width - 160]);
let cluster = d3.cluster().size([height, width - 160]);

// Style Definitions (Moved outside of function for efficiency)
svg.append("defs").append("style").text(`
  .node circle { fill: #999; }
  .node text { font: 12px sans-serif; }
  .node--internal circle { fill: #555; }
  .node--internal text { text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff; }
  .link { fill: none; stroke: #555; stroke-opacity: 0.4; stroke-width: 1.5px; }
`);

let root, link, node; 

function updateVisualization(data) {

  root = d3.hierarchy(data, d => d.children);
  cluster(root);

  // Clear previous elements
  svg.selectAll(".link").remove();
  svg.selectAll(".node").remove();

  // Create links and nodes
  link = svg.selectAll(".link")
    .data(root.descendants().slice(1))
    .join("path")
    .attr("class", "link")
    .attr("d", diagonal);

  node = svg.selectAll(".node")
    .data(root.descendants())
    .join("g")
    .attr("class", d => "node" + (d.children ? " node--internal" : " node--leaf"))
    .attr("transform", d => `translate(${d.y},${d.x})`); 

  node.append("circle").attr("r", 2.5);
  node.append("text")
    .attr("dy", ".35em")
    .attr("x", d => d.children ? -13 : 13)
    .attr("text-anchor", d => d.children ? "end" : "start")
    .text(d => d.data.name);
}


// Initial visualization
updateVisualization(datasets.overview); 

// Dropdown Change Event
d3.select("#datasetSelect").on("change", function() {
  const selectedDataset = this.value;
  updateVisualization(datasets[selectedDataset]);
  changed(); // Apply the current layout mode to the new data
});



d3.selectAll("input")
    .on("click", changed);

function changed() {
    (this.value === "tree" ? tree : cluster)(root);
    var t = d3.transition().duration(750);
    node.transition(t).attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; });
    link.transition(t).attr("d", diagonal);
}

function diagonal(d) {
  return "M" + d.y + "," + d.x
    + "C" + (d.parent.y + 100) + "," + d.x
    + " " + (d.parent.y + 100) + "," + d.parent.x
    + " " + d.parent.y + "," + d.parent.x;
}

// save as svg
function diagonal(d) {
  return "M" + d.y + "," + d.x
    + "C" + (d.parent.y + 100) + "," + d.x
    + " " + (d.parent.y + 100) + "," + d.parent.x
    + " " + d.parent.y + "," + d.parent.x;
}
// Embed styles function
function embedStyles(svgElement) {
    const styles = `
    .node circle {
        fill: #999;
    }
    .node text {
        font: 12px sans-serif;
    }
    .node--internal circle {
        fill: #555;
    }
    .node--internal text {
        text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;
    }
    .link {
        fill: none;
        stroke: #555;
        stroke-opacity: 0.4;
        stroke-width: 1.5px;
    }
    `;
    
    const styleElement = document.createElement("style");
    styleElement.setAttribute("type", "text/css");
    styleElement.innerHTML = styles;

    const defsElement = document.createElement("defs");
    defsElement.appendChild(styleElement);

    svgElement.insertBefore(defsElement, svgElement.firstChild);
}

// Save as SVG functionality
document.getElementById('saveButton').addEventListener('click', function() {
    var svgElement = document.querySelector('svg');
    embedStyles(svgElement); // Embed the styles before serialization

    var serializer = new XMLSerializer();
    var svgString = serializer.serializeToString(svgElement);
    var blob = new Blob([svgString], {type: 'image/svg+xml;charset=utf-8'});
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'topic_tree_visualization.svg';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
});
</script>

</script>


