<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>SSRIdataTree Visualization</title>
    <style>
      .node circle {
        fill: #fff;
        stroke: steelblue;
        stroke-width: 3px;
      }

      .node text {
        font: 12px sans-serif;
      }

      .link {
        fill: none;
        stroke: #ccc;
        stroke-width: 2px;
      }

      svg {
        margin-bottom: 50px; /* Add vertical spacing between trees */
      }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body>
    <script>
      const SSRIdataTree = [
        // first tree
        {
          name: "Pharmacology",
          children: [
            {
              name: "Pharmacokinetics",
              children: [
                { name: "Analytical Methods" },
                { name: "Cytochromes" },
                { name: "Blood-Brain Barrier" },
              ],
            },
            {
              name: "Pharmacodynamics",
              children: [
                { name: "Metabolism" },
                { name: "Mechanism of Action" },
              ],
            },
            { name: "Pharmacogenetics" },
          ],
        },

        // second tree
        {
          name: "Indications",
          children: [
            {
              name: "Disorder/Disease",
              children: [
                { name: "Depression" },
                { name: "Anxiety" },
                { name: "Other" },
              ],
            },
            {
              name: "Special Populations",
              children: [
                { name: "Pregnancy" },
                { name: "Pediatrics" },
                { name: "Other" },
              ],
            },
            { name: "Pharmacoepidemiology" },
          ],
        },

        // third tree
        {
          name: "Safety",
          children: [
            { name: "Adverse Effects" },
            { name: "Drug Interactions" },
            { name: "Overdose" },
            { name: "Other" },
          ],
        },

        // fourth tree
        {
          name: "Other",
          children: [
            { name: "Environment" },
            { name: "Economics" },
            { name: "Misc" },
          ],
        },
      ];

      // Set dimensions and margins
      const width = 960;
      const heightPerTree = 550; // Adjust based on your data complexity
      const margin = { top: 40, right: 90, bottom: 50, left: 90 };

      // Calculate total height needed for all trees, adding extra space for the last tree
      const extraSpaceForLastTree = 100; // Adjust the value as needed
      const totalHeight =
        SSRIdataTree.length * (heightPerTree + margin.top + margin.bottom) +
        extraSpaceForLastTree;

      // Create a single SVG to contain all trees
      const svg = d3
        .select("body")
        .append("svg")
        .attr("width", width)
        .attr("height", totalHeight);

      // Iterate through the trees and position them vertically
      SSRIdataTree.forEach((treeData, i) => {
        // Create a group (g) element for each tree, translated vertically
        const g = svg
          .append("g")
          .attr(
            "transform",
            `translate(${margin.left},${
              i * (heightPerTree + margin.top + margin.bottom) + margin.top
            })`
          );

        // Tree layout setup
        const treemap = d3
          .tree()
          .size([
            width - margin.right - margin.left,
            heightPerTree - margin.top - margin.bottom,
          ])
          .separation((a, b) => (a.parent == b.parent ? 0.2 : 2));

        const root = d3.hierarchy(treeData, (d) => d.children);
        treemap(root);

        // Links
        g.selectAll(".link")
          .data(root.descendants().slice(1))
          .join("path")
          .attr("class", "link")
          .attr(
            "d",
            (d) => `
      M${d.y},${d.x}
      C${(d.y + d.parent.y) / 2},${d.x} ${(d.y + d.parent.y) / 2},${
              d.parent.x
            } ${d.parent.y},${d.parent.x}
    `
          );

        // Links
        g.selectAll(".link")
          .data(root.descendants().slice(1))
          .join("path")
          .attr("class", "link")
          .attr(
            "d",
            (d) => `
      M${d.y},${d.x}
      C${(d.y + d.parent.y) / 2},${d.x} ${(d.y + d.parent.y) / 2},${
              d.parent.x
            } ${d.parent.y},${d.parent.x}
    `
          );

        // Nodes
        const node = g
          .selectAll(".node")
          .data(root.descendants())
          .join("g")
          .attr("class", "node")
          .attr("transform", (d) => `translate(${d.y},${d.x})`);

        node.append("circle").attr("r", 10);

        node
          .append("text")
          .attr("dy", ".35em")
          .attr("x", (d) => (d.children ? -13 : 13))
          .attr("text-anchor", (d) => (d.children ? "end" : "start"))
          .text((d) => d.data.name);
      });
    </script>
  </body>
</html>
